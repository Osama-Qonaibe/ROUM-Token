name: "Test Environment Secrets"

# ÿ™ÿ¥ÿ∫ŸäŸÑ ŸäÿØŸàŸä ŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÄ Secrets
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to test'
        required: true
        default: 'copilot'
        type: choice
        options:
          - copilot
          - production
          - staging

permissions:
  contents: read

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    # ÿ±ÿ®ÿ∑ ÿ®ÿßŸÑÿ®Ÿäÿ¶ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
    environment: ${{ github.event.inputs.environment }}
    
    steps:
      # 1Ô∏è‚É£ ÿßÿ≥ÿ™ŸÜÿ≥ÿßÿÆ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 2Ô∏è‚É£ ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶ÿ©
      - name: Display environment info
        run: |
          echo "========================================"
          echo "üîç Environment Information"
          echo "========================================"
          echo "Environment: ${{ github.event.inputs.environment }}"
          echo "Repository: ${{ github.repository }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Triggered by: ${{ github.actor }}"
          echo "Timestamp: $(date)"
          echo "========================================"
      
      # 3Ô∏è‚É£ ÿßÿÆÿ™ÿ®ÿßÿ± Blockchain Secrets
      - name: Test Blockchain Secrets
        run: |
          echo "üîê Testing Blockchain-related Secrets..."
          echo "---"
          
          # Test DEPLOYER_PRIVATE_KEY
          if [ -n "${{ secrets.DEPLOYER_PRIVATE_KEY }}" ]; then
            echo "‚úÖ DEPLOYER_PRIVATE_KEY is configured"
            echo "   - Length: ${#DEPLOYER_PRIVATE_KEY} characters"
          else
            echo "‚ùå DEPLOYER_PRIVATE_KEY is NOT configured"
            exit 1
          fi
          
          # Test BSC_PRIVATE_KEY
          if [ -n "${{ secrets.BSC_PRIVATE_KEY }}" ]; then
            echo "‚úÖ BSC_PRIVATE_KEY is configured"
            echo "   - Length: ${#BSC_PRIVATE_KEY} characters"
          else
            echo "‚ö†Ô∏è  BSC_PRIVATE_KEY is NOT configured (optional for development)"
          fi
          
          # Test BSCSCAN_API_KEY
          if [ -n "${{ secrets.BSCSCAN_API_KEY }}" ]; then
            echo "‚úÖ BSCSCAN_API_KEY is configured"
          else
            echo "‚ö†Ô∏è  BSCSCAN_API_KEY is NOT configured (needed for verification)"
          fi
          
          # Test INFURA_API_KEY
          if [ -n "${{ secrets.INFURA_API_KEY }}" ]; then
            echo "‚úÖ INFURA_API_KEY is configured"
          else
            echo "‚ö†Ô∏è  INFURA_API_KEY is NOT configured (needed for Ethereum connection)"
          fi
          
          # Test ALCHEMY_API_KEY (alternative)
          if [ -n "${{ secrets.ALCHEMY_API_KEY }}" ]; then
            echo "‚úÖ ALCHEMY_API_KEY is configured (alternative to Infura)"
          else
            echo "‚ö†Ô∏è  ALCHEMY_API_KEY is NOT configured"
          fi
          
          # Test ETHERSCAN_API_KEY
          if [ -n "${{ secrets.ETHERSCAN_API_KEY }}" ]; then
            echo "‚úÖ ETHERSCAN_API_KEY is configured"
          else
            echo "‚ö†Ô∏è  ETHERSCAN_API_KEY is NOT configured (optional)"
          fi
          
          echo "---"
        env:
          DEPLOYER_PRIVATE_KEY: ${{ secrets.DEPLOYER_PRIVATE_KEY }}
          BSC_PRIVATE_KEY: ${{ secrets.BSC_PRIVATE_KEY }}
          BSCSCAN_API_KEY: ${{ secrets.BSCSCAN_API_KEY }}
          INFURA_API_KEY: ${{ secrets.INFURA_API_KEY }}
          ALCHEMY_API_KEY: ${{ secrets.ALCHEMY_API_KEY }}
          ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}
      
      # 4Ô∏è‚É£ ÿßÿÆÿ™ÿ®ÿßÿ± Integration Secrets
      - name: Test Integration Secrets
        run: |
          echo "üîå Testing Integration Secrets..."
          echo "---"
          
          # Test CODECOV_TOKEN
          if [ -n "${{ secrets.CODECOV_TOKEN }}" ]; then
            echo "‚úÖ CODECOV_TOKEN is configured"
          else
            echo "‚ö†Ô∏è  CODECOV_TOKEN is NOT configured (optional)"
          fi
          
          # Test SLACK_WEBHOOK_URL
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            echo "‚úÖ SLACK_WEBHOOK_URL is configured"
          else
            echo "‚ö†Ô∏è  SLACK_WEBHOOK_URL is NOT configured (optional)"
          fi
          
          # Test TELEGRAM_BOT_TOKEN
          if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
            echo "‚úÖ TELEGRAM_BOT_TOKEN is configured"
          else
            echo "‚ö†Ô∏è  TELEGRAM_BOT_TOKEN is NOT configured (optional)"
          fi
          
          # Test GITHUB_TOKEN (auto-provided)
          if [ -n "${{ secrets.GITHUB_TOKEN }}" ]; then
            echo "‚úÖ GITHUB_TOKEN is available (auto-provided)"
          else
            echo "‚ùå GITHUB_TOKEN is missing (should be auto-provided)"
            exit 1
          fi
          
          echo "---"
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # 5Ô∏è‚É£ ÿßÿÆÿ™ÿ®ÿßÿ± Environment Variables
      - name: Test Environment Variables
        run: |
          echo "üåç Testing Environment Variables..."
          echo "---"
          
          # Test NODE_ENV
          if [ -n "${{ vars.NODE_ENV }}" ]; then
            echo "‚úÖ NODE_ENV is set: ${{ vars.NODE_ENV }}"
          else
            echo "‚ö†Ô∏è  NODE_ENV is NOT configured"
          fi
          
          # Test NETWORK_TYPE
          if [ -n "${{ vars.NETWORK_TYPE }}" ]; then
            echo "‚úÖ NETWORK_TYPE is set: ${{ vars.NETWORK_TYPE }}"
          else
            echo "‚ö†Ô∏è  NETWORK_TYPE is NOT configured"
          fi
          
          # Test CHAIN_ID
          if [ -n "${{ vars.CHAIN_ID }}" ]; then
            echo "‚úÖ CHAIN_ID is set: ${{ vars.CHAIN_ID }}"
          else
            echo "‚ö†Ô∏è  CHAIN_ID is NOT configured"
          fi
          
          echo "---"
      
      # 6Ô∏è‚É£ ŸÖŸÑÿÆÿµ ŸÜŸáÿßÿ¶Ÿä
      - name: Summary
        if: always()
        run: |
          echo ""
          echo "========================================"
          echo "üìä Test Summary"
          echo "========================================"
          echo ""
          echo "‚úÖ Secrets test completed successfully!"
          echo ""
          echo "üìã Next steps:"
          echo "   1. If all secrets are ‚úÖ: You can use them in workflows"
          echo "   2. If some are ‚ö†Ô∏è: They're optional, proceed as needed"
          echo "   3. If any are ‚ùå: Configure them before production"
          echo ""
          echo "üí° To add missing secrets:"
          echo "   - Go to: Settings ‚Üí Environments ‚Üí ${{ github.event.inputs.environment }}"
          echo "   - Click: 'Add environment secret'"
          echo "   - Add the missing secret"
          echo ""
          echo "üöÄ You can now use these secrets in your workflows!"
          echo "========================================"
          echo ""
      
      # 7Ô∏è‚É£ ÿ•ÿ¥ÿπÿßÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
      - name: Send success notification
        if: success() && vars.SLACK_WEBHOOK_URL != ''
        run: |
          curl -X POST "${{ vars.SLACK_WEBHOOK_URL }}" \
            -H 'Content-Type: application/json' \
            -d '{
              "text": "‚úÖ Environment Secrets Test Passed!",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*‚úÖ Environment Secrets Test Passed!*\n\nEnvironment: ${{ github.event.inputs.environment }}\nRepository: ${{ github.repository }}\nBranch: ${{ github.ref_name }}\n\nAll required secrets are configured and ready to use."
                  }
                }
              ]
            }'
        continue-on-error: true
      
      # 8Ô∏è‚É£ ÿ•ÿ¥ÿπÿßÿ± ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑ
      - name: Send failure notification
        if: failure() && vars.SLACK_WEBHOOK_URL != ''
        run: |
          curl -X POST "${{ vars.SLACK_WEBHOOK_URL }}" \
            -H 'Content-Type: application/json' \
            -d '{
              "text": "‚ùå Environment Secrets Test Failed!",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*‚ùå Environment Secrets Test Failed!*\n\nEnvironment: ${{ github.event.inputs.environment }}\nRepository: ${{ github.repository }}\n\nSome required secrets are missing. Please configure them."
                  }
                }
              ]
            }'
        continue-on-error: true

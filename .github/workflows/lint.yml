name: lint

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  lint:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    strategy:
      matrix:
        node-version: [18.x]

    steps:
    - uses: actions/checkout@v4

    - name: Check package.json exists
      id: check-package
      run: |
        if [ -f package.json ]; then
          echo "✅ package.json found"
          echo "exists=true" >> $GITHUB_OUTPUT
        else
          echo "⚠️  package.json not found - skipping lint"
          echo "exists=false" >> $GITHUB_OUTPUT
        fi

    - name: Use Node.js ${{ matrix.node-version }}
      if: steps.check-package.outputs.exists == 'true'
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        # Removed cache: 'npm' to avoid requiring lock files

    - name: Install dependencies
      if: steps.check-package.outputs.exists == 'true'
      run: npm install

    - name: Run ESLint (if config exists)
      if: steps.check-package.outputs.exists == 'true'
      run: |
        # Check if any ESLint config file exists
        if find . -maxdepth 1 \( -name '.eslintrc.*' -o -name 'eslint.config.*' \) -print -quit | grep -q .; then
          # Check if lint script exists in package.json
          if grep -q '"lint"' package.json; then
            npm run lint
          else
            echo "⚠️  ESLint config found but no 'lint' script in package.json - running ESLint directly"
            npx eslint .
          fi
        else
          echo "⚠️  ESLint config not found - skipping lint"
        fi
      continue-on-error: true
